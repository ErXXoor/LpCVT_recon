import os
import trimesh
import subprocess
obj_list = [37278, 37280, 37384, 37964, 37967, 37968, 37972, 38643, 38644, 39950, 40982, 40985, 40986, 40987, 40988, 40992, 40994, 41098, 41360, 42155, 42156, 42370, 43188, 44381, 44498, 44710, 45090, 46780, 48270, 48552, 48558, 49544, 49545, 49549, 51009, 51010, 51013, 51016, 53404, 53406, 56265, 56524, 57140, 57908, 57937, 57993, 58564, 58938, 59125, 59333, 59752, 61585, 62286, 63245, 64957, 65612, 65616, 65617, 66478, 66484, 66486, 66783, 66566, 67919, 67923, 67924, 67926, 67524, 68380, 68382, 69689, 69930, 69985, 70060, 72203, 72581, 72613, 72881, 72960, 73155, 75115, 75118, 75359, 75652, 75653, 76947, 77939, 77941, 77945, 78319, 78733, 78976, 79189, 79195, 79810, 80353, 80354, 80603, 80604, 80750, 81148, 87355, 90434, 92837, 98480, 100388, 101619, 101635, 101636, 103141, 107910, 109015, 110793, 111240, 116878, 126660, 127243, 129914, 129918, 131453, 131969, 133078, 133079, 133275, 137976, 157174, 163763, 200077,
            200079, 200082, 202265, 203289, 212135, 212136, 216763, 218730, 230909, 247069, 252614, 252631, 252632, 252635, 252636, 257594, 265728, 265730, 274379, 278455, 285606, 285607, 285610, 286161, 313873, 313875, 313881, 313882, 313883, 313884, 313917, 319831, 331105, 368147, 372055, 372056, 409624, 441708, 461109, 461110, 461111, 490704, 518029, 518039, 518033, 518034, 518035, 518036, 518037, 518038, 518079, 518080, 518081, 518082, 518083, 518084, 518085, 518086, 518087, 518088, 518089, 518090, 518091, 518092, 518093, 518094, 518095, 522979, 551074, 613009, 621686, 669964, 740391, 762584, 762586, 762592, 762595, 762596, 762600, 762602, 762603, 762604, 763714, 789069, 789072, 789073, 796150, 804293, 804297, 815480, 816584, 816585, 856334, 914672, 914680, 914681, 958474, 958477, 958479, 958480, 977256, 985159, 991313, 1028706, 1215417, 1288652, 1399249, 1411686, 1411696, 1411702, 1417954, 1417965, 1417966, 1706459, 1717684, 1717685]

base_path_hd = "/media/hongbo/45ad552c-e83b-4f01-9864-7d87cfa1377e/hongbo/Thing10k_tetwild/hd_output_opt"
lp_exe = "/home/hongbo/Desktop/code/LpCVT_recon/cmake-build-release/src/src"
name_ext = "emb"

for obj_id in obj_list:
    param = ["", "", "", "", "", ""]
    input_path = os.path.join(base_path_hd,
                              str(obj_id),
                              "{}_{}.obj".format(obj_id, name_ext))
    obj_path = os.path.join(base_path_hd,
                            str(obj_id),
                            "{}_{}.obj".format(obj_id, "sf_norm"))
    output_path = os.path.join(base_path_hd,
                               str(obj_id),
                               "{}_{}_tri.obj".format(obj_id, name_ext))

    iter_num = 400
    mesh = trimesh.load(obj_path)
    verts_num = len(mesh.vertices)
    param[0] = input_path
    param[1] = output_path
    param[2] = str(8)
    param[3] = str(iter_num)
    param[4] = str(verts_num)
    param[5] = "false"
    print(param)
    command = [lp_exe]+param
    try:
        returncode = subprocess.call(command)
        print("Return code:", returncode)
    except Exception as e:
        print("An error occurred:", str(e))
